<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RO:W 公會名冊 | 躺著不想動</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#dbeafe">

    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/styles.css"> 
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { ro: { primary: '#3b82f6', bg: '#eff6ff' } },
                    fontFamily: {
                        'cute': ['"ZCOOL KuaiLe"', 'cursive'],
                        'sans': ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        'varela': ['"Varela Round"', 'sans-serif']
                    },
                }
            }
        }
    </script>
    <style>
        .bg-job-knight.bg-opacity-20 { background-color: rgba(59, 130, 246, 0.2); }
        .bg-job-crusader.bg-opacity-20 { background-color: rgba(16, 185, 129, 0.2); }
        .bg-job-blacksmith.bg-opacity-20 { background-color: rgba(245, 158, 11, 0.2); }
        .bg-job-hunter.bg-opacity-20 { background-color: rgba(20, 184, 166, 0.2); }
        .bg-job-assassin.bg-opacity-20 { background-color: rgba(139, 92, 246, 0.2); }
        .bg-job-mage.bg-opacity-20 { background-color: rgba(239, 68, 68, 0.2); }
        .bg-job-sage.bg-opacity-20 { background-color: rgba(244, 114, 182, 0.2); }
        .bg-job-priest.bg-opacity-20 { background-color: rgba(249, 115, 22, 0.2); }
        .bg-job-bard.bg-opacity-20 { background-color: rgba(100, 116, 139, 0.2); }
        .bg-job-rogue.bg-opacity-20 { background-color: rgba(236, 72, 153, 0.2); }
        .bg-job-alchemist.bg-opacity-20 { background-color: rgba(163, 230, 53, 0.2); }
        .bg-job-monk.bg-opacity-20 { background-color: rgba(217, 70, 239, 0.2); }
        .bg-job-gunslinger.bg-opacity-20 { background-color: rgba(6, 182, 212, 0.2); }
        .bg-job-dancer.bg-opacity-20 { background-color: rgba(244, 63, 94, 0.2); }
        .bg-job-default.bg-opacity-20 { background-color: rgba(209, 213, 219, 0.2); }
    </style>
</head>
<body class="bg-ro-bg min-h-screen flex flex-col font-sans">
    
    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-md border-b border-white/40 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-black text-slate-800 tracking-wider font-varela">
                <span class="title-effect">公會名冊</span>
            </h1>
            <div class="flex items-center space-x-3">
                <button onclick="app.showHistoryModal()" class="text-slate-500 hover:text-slate-800 p-2 rounded-full transition"><i class="fas fa-history text-lg"></i></button>
                <button onclick="app.openLoginModal()" class="text-slate-500 hover:text-slate-800 p-2 rounded-full transition" id="adminButton"><i class="fas fa-user-lock text-lg"></i></button>
            </div>
        </div>
    </header>

    <!-- Navigation Pills -->
    <div class="bg-white/60 backdrop-blur-md border-b border-white/40 sticky top-[64px] z-40 shadow-sm" id="nav-container">
        <div class="container mx-auto px-4 py-2 flex space-x-2 overflow-x-auto scroll-hide">
            <button onclick="app.switchTab('home')" id="tab-home" class="nav-pill"><i class="fas fa-home mr-1"></i> 首頁</button>
            <button onclick="app.switchTab('members')" id="tab-members" class="nav-pill"><i class="fas fa-users mr-1"></i> 名冊</button>
            <!-- 改名：團戰 -->
            <button onclick="app.switchTab('gvg')" id="tab-gvg" class="nav-pill"><i class="fas fa-crosshairs mr-1"></i> 團戰</button>
            <button onclick="app.switchTab('groups')" id="tab-groups" class="nav-pill"><i class="fas fa-campground mr-1"></i> 固定團</button>
            <button onclick="app.switchTab('leave')" id="tab-leave" class="nav-pill"><i class="fas fa-file-signature mr-1"></i> 請假</button>
            <button onclick="app.switchTab('activity')" id="tab-activity" class="nav-pill"><i class="fas fa-trophy mr-1"></i> 活動</button>
        </div>
    </div>
    
    <main class="flex-grow container mx-auto p-4 md:p-6 space-y-6 max-w-5xl safe-area-bottom">

        <div id="view-home" class="animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div onclick="app.switchTab('members')" class="menu-card group border-l-4 border-l-blue-500">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center text-xl group-hover:scale-110 transition duration-300 shadow-sm"><i class="fas fa-users"></i></div>
                            <div>
                                <h3 class="text-lg font-black text-slate-700">成員名冊</h3>
                                <p class="text-xs text-slate-400 font-bold tracking-wider">MEMBER LIST</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-blue-500 transition"></i>
                    </div>
                </div>

                <!-- 改名：團戰點名 -->
                <div onclick="app.switchTab('gvg')" class="menu-card group border-l-4 border-l-red-500">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-red-50 text-red-600 flex items-center justify-center text-xl group-hover:scale-110 transition duration-300 shadow-sm"><i class="fas fa-crosshairs"></i></div>
                            <div>
                                <h3 class="text-lg font-black text-slate-700">團戰點名</h3>
                                <p class="text-xs text-slate-400 font-bold tracking-wider">TEAM BATTLE</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-red-500 transition"></i>
                    </div>
                </div>

                <div onclick="app.switchTab('leave')" class="menu-card group border-l-4 border-l-purple-500">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-purple-50 text-purple-600 flex items-center justify-center text-xl group-hover:scale-110 transition duration-300 shadow-sm"><i class="fas fa-file-signature"></i></div>
                            <div>
                                <h3 class="text-lg font-black text-slate-700">請假管理</h3>
                                <p class="text-xs text-slate-400 font-bold tracking-wider">LEAVE REQUESTS</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-purple-500 transition"></i>
                    </div>
                </div>

                <div onclick="app.switchTab('groups')" class="menu-card group border-l-4 border-l-green-500">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-green-50 text-green-600 flex items-center justify-center text-xl group-hover:scale-110 transition duration-300 shadow-sm"><i class="fas fa-campground"></i></div>
                            <div>
                                <h3 class="text-lg font-black text-slate-700">固定團</h3>
                                <p class="text-xs text-slate-400 font-bold tracking-wider">FIXED SQUADS</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-green-500 transition"></i>
                    </div>
                </div>

                <div onclick="app.switchTab('activity')" class="menu-card group border-l-4 border-l-yellow-500">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-yellow-50 text-yellow-600 flex items-center justify-center text-xl group-hover:scale-110 transition duration-300 shadow-sm"><i class="fas fa-trophy"></i></div>
                            <div>
                                <h3 class="text-lg font-black text-slate-700">活動紀錄</h3>
                                <p class="text-xs text-slate-400 font-bold tracking-wider">ACTIVITY LOG</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-slate-300 group-hover:text-yellow-500 transition"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="view-members" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-700 flex items-center"><i class="fas fa-users-viewfinder mr-2 text-blue-500"></i>成員名單</h2>
                <div class="flex space-x-2">
                    <button onclick="app.handleMainAction()" class="bg-blue-600 hover:bg-blue-700 text-white shadow-lg px-3 py-2 rounded-xl font-bold transition text-sm active:scale-95 border-2 border-blue-800"><i class="fas fa-user-plus mr-1"></i> 新增成員</button>
                    <button onclick="app.exportCSV()" class="bg-gray-200 hover:bg-gray-300 text-slate-700 shadow-lg px-3 py-2 rounded-xl font-bold transition text-sm active:scale-95"><i class="fas fa-download mr-1"></i> 匯出</button>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl p-3 mb-4 shadow-sm border border-slate-200 grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="relative w-full md:col-span-2">
                    <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                    <input type="text" id="memberSearchInput" oninput="app.renderMembers()" placeholder="搜尋成員名稱/職業..." class="w-full bg-slate-50 border-0 text-slate-800 rounded-xl pl-10 pr-4 py-2.5 outline-none font-bold focus:ring-2 focus:ring-blue-200 transition placeholder-slate-400">
                </div>
                <select id="jobFilterSelect" onchange="app.setJobFilter(this.value)" class="w-full bg-slate-50 border-0 text-slate-800 rounded-xl p-3 outline-none font-bold focus:ring-2 focus:ring-blue-200 transition"></select>
            </div>

            <div id="memberList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"></div>
            <div id="noMembersMsg" class="hidden text-center py-20 text-slate-400">
                <div class="text-6xl mb-4 text-slate-200"><i class="fas fa-ghost"></i></div>
                <p class="text-slate-400 font-bold">沒有符合條件的成員</p>
            </div>
        </div>

        <div id="view-groups" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 id="squads-title" class="text-xl font-bold text-slate-700 flex items-center"></h2>
                <button onclick="app.handleMainAction()" class="bg-red-600 hover:bg-red-700 text-white shadow-lg px-3 py-2 rounded-xl font-bold transition text-sm active:scale-95 border-2 border-red-800"><i class="fas fa-plus mr-1"></i> 新增隊伍</button>
            </div>

            <!-- 新增：團戰主題選擇 (只在 GVG tab 顯示) -->
            <div id="gvgThemeSelector" class="bg-white rounded-2xl p-4 mb-4 shadow-sm border border-slate-200 hidden">
                <div class="flex justify-between items-center mb-2">
                    <label for="gvgThemeSelect" class="block text-xs text-slate-500 font-bold">團戰主題/場次</label>
                    <button id="addThemeBtn" onclick="app.openThemeModal()" class="text-xs text-red-500 hover:text-red-700 font-bold hidden"><i class="fas fa-plus mr-1"></i> 新增主題</button>
                </div>
                <select id="gvgThemeSelect" onchange="app.selectTheme(this.value)" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-red-200 text-slate-700"></select>
            </div>

            <div id="squads-list" class="space-y-4"></div>
            <div id="noSquadsMsg" class="hidden text-center py-20 text-slate-400">
                <div class="text-6xl mb-4 text-slate-200"><i class="fas fa-layer-group"></i></div>
                <p class="text-slate-400 font-bold">目前沒有固定團或團戰分流</p>
            </div>
        </div>

        <div id="view-leave" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-700 flex items-center"><i class="fas fa-file-signature mr-2 text-purple-500"></i>請假紀錄</h2>
                <button onclick="app.handleMainAction()" class="bg-purple-600 hover:bg-purple-700 text-white shadow-lg px-3 py-2 rounded-xl font-bold transition text-sm active:scale-95 border-2 border-purple-800"><i class="fas fa-plus mr-1"></i> 新增假單</button>
            </div>

            <div class="bg-white rounded-2xl p-3 mb-4 shadow-sm border border-slate-200 grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="relative w-full">
                    <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                    <input type="text" id="leaveSearchInput" oninput="app.renderLeaveRequests()" placeholder="搜尋成員..." class="w-full bg-slate-50 border-0 text-slate-800 rounded-xl pl-10 pr-4 py-2.5 outline-none font-bold focus:ring-2 focus:ring-purple-200 transition placeholder-slate-400">
                </div>
                <div class="relative w-full">
                    <i class="fas fa-calendar absolute left-3 top-3 text-slate-400"></i>
                    <input type="date" id="leaveDateFilter" onchange="app.renderLeaveRequests()" class="w-full bg-slate-50 border-0 text-slate-800 rounded-xl pl-10 pr-4 py-2.5 outline-none font-bold focus:ring-2 focus:ring-purple-200 transition placeholder-slate-400">
                </div>
            </div>

            <div id="leaveList" class="space-y-3"></div>
            <div id="noLeavesMsg" class="hidden text-center py-20 text-slate-400">
                <div class="text-6xl mb-4 text-slate-200"><i class="fas fa-clipboard-check"></i></div>
                <p class="text-slate-400 font-bold">目前沒有請假紀錄</p>
            </div>
        </div>

        <div id="view-activity" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-700 flex items-center"><i class="fas fa-trophy mr-2 text-yellow-500"></i>活動紀錄</h2>
                <button onclick="app.handleMainAction()" class="bg-yellow-600 hover:bg-yellow-700 text-white shadow-lg px-3 py-2 rounded-xl font-bold transition text-sm active:scale-95 border-2 border-yellow-800"><i class="fas fa-plus mr-1"></i> 新增活動</button>
            </div>
            <div id="activityList" class="space-y-4"></div>
            <div id="noActivitiesMsg" class="hidden text-center py-20 text-slate-400">
                <div class="text-6xl mb-4 text-slate-200"><i class="fas fa-box-open"></i></div>
                <p class="text-slate-400 font-bold">尚未舉辦任何活動</p>
            </div>
        </div>

        <!-- Modals -->
        <div id="loginModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col border border-white/50">
                <button onclick="app.closeModal('loginModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-user-lock mr-2 text-blue-500"></i>管理員登入</h3>
                <div id="loginForm" class="space-y-4">
                    <input type="password" id="adminPassword" class="w-full bg-slate-50 border-0 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-200" placeholder="請輸入管理密碼">
                    <button onclick="app.handleLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl p-3 shadow-lg active:scale-95 transition">登入</button>
                </div>
                <div id="configSection" class="mt-6 pt-4 border-t border-slate-100">
                    <h4 class="text-sm font-bold text-slate-600 mb-2">Firestore 連線設定 (會長專用)</h4>
                    <textarea id="firebaseConfigInput" rows="5" class="w-full bg-slate-50 border-slate-300 rounded-xl p-3 text-xs font-mono resize-none focus:ring-2 focus:ring-blue-200" placeholder="貼上 Firebase 配置 JSON" readonly></textarea>
                    <div class="flex justify-between items-center">
                        <button onclick="app.resetToDemo()" class="text-red-400 text-xs hover:text-red-600">重置資料</button>
                        <button onclick="app.saveConfig()" class="px-4 py-2 bg-slate-800 text-white rounded-xl hover:bg-slate-900 transition shadow-lg">連線</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="historyModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative max-h-[90vh] overflow-y-auto border border-white/50">
                <button onclick="app.closeModal('historyModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-history mr-2 text-yellow-600"></i>修改紀錄 (保留30天)</h3>
                <div id="historyList" class="space-y-3"></div>
            </div>
        </div>

        <div id="squadModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col max-h-[90vh] border border-white/50">
                <button onclick="app.closeModal('squadModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 id="squadModalTitle" class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-layer-group mr-2 text-red-500"></i>新增分流/隊伍</h3>
                <div class="flex-grow overflow-y-auto space-y-4 custom-scrollbar">
                    <input type="hidden" id="squadIdInput">
                    <input type="hidden" id="squadTypeInput">
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">隊伍名稱</label>
                        <input type="text" id="squadNameInput" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-red-200 text-slate-700" placeholder="例如：團戰一分流、固定副本團">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">備註</label>
                        <textarea id="squadNoteInput" rows="2" class="w-full bg-slate-50 border-0 rounded-xl p-3 outline-none focus:ring-2 focus:ring-red-200" placeholder="備註資訊，例如：只打塔、坦補法..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-500 mb-2 font-bold flex justify-between">
                            <span>選擇成員 (已選 <span id="squadMemberCount">0</span> 人)</span>
                            <div class="flex space-x-2">
                                <select id="squadMemberRoleFilter" onchange="app.renderSquadMemberSelect()" class="bg-slate-50 border border-slate-200 rounded-lg px-2 py-0.5 text-xs">
                                    <option value="all">所有職位</option>
                                    <option value="tank">坦克</option>
                                    <option value="physical_dps">物理輸出</option>
                                    <option value="magical_dps">魔法輸出</option>
                                    <option value="support">輔助</option>
                                    <option value="utility">功能</option>
                                    <option value="other">其他</option>
                                </select>
                                <input type="text" id="squadMemberSearch" oninput="app.renderSquadMemberSelect()" placeholder="搜尋..." class="bg-slate-50 border border-slate-200 rounded-lg px-2 py-0.5 text-xs w-24">
                            </div>
                        </label>
                        <div id="squadMemberSelectGrid" class="grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-[300px] overflow-y-auto p-1 border border-slate-200 rounded-xl"></div>
                    </div>
                </div>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-slate-100 shrink-0 gap-3">
                     <button type="button" onclick="app.deleteSquad()" id="deleteSquadBtn" class="px-4 py-2 text-red-500 hover:text-red-700 font-bold hidden">刪除</button>
                     <button type="button" onclick="app.closeModal('squadModal')" class="px-4 py-2 text-slate-500 hover:text-slate-800 font-bold">取消</button>
                     <button type="button" onclick="app.saveSquad()" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg active:scale-95 transition border-b-4 border-red-800">儲存隊伍</button>
                </div>
            </div>
        </div>

        <div id="leaveModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col max-h-[90vh] border border-white/50">
                <button onclick="app.closeModal('leaveModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-pen-nib mr-2 text-purple-500"></i>新增請假單</h3>
                <div class="flex-grow overflow-y-auto space-y-4 custom-scrollbar">
                    
                    <!-- 新增：請假主題選擇 -->
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">請假主題/場次</label>
                        <select id="leaveThemeSelect" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-purple-200 text-slate-700"></select>
                    </div>

                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">請假日期</label>
                        <input type="date" id="leaveDateInput" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-purple-200 text-slate-700">
                    </div>

                    <div>
                        <label class="block text-xs text-slate-500 mb-2 font-bold flex justify-between">
                            <span>選擇成員</span>
                            <input type="text" id="leaveMemberSearch" oninput="app.renderLeaveMemberSelect()" placeholder="搜尋..." class="bg-slate-50 border border-slate-200 rounded-lg px-2 py-0.5 text-xs w-24">
                        </label>
                        <div id="leaveMemberSelectGrid" class="grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-[200px] overflow-y-auto p-1"></div>
                        <input type="hidden" id="selectedLeaveMemberId">
                    </div>

                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">詳細原因</label>
                        <textarea id="leaveReason" rows="2" class="w-full bg-slate-50 border-0 rounded-xl p-3 outline-none focus:ring-2 focus:ring-purple-200" placeholder="例如：加班、出國..."></textarea>
                    </div>
                </div>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-slate-100 shrink-0 gap-3">
                     <button type="button" onclick="app.closeModal('leaveModal')" class="px-4 py-2 text-slate-500 hover:text-slate-800 font-bold">取消</button>
                     <button type="button" onclick="app.saveLeaveRequest()" class="px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-xl shadow-lg active:scale-95 transition border-b-4 border-purple-800">送出假單</button>
                </div>
            </div>
        </div>

        <!-- 新增：主題管理 Modal (會長專用) -->
        <div id="themeModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col max-h-[90vh] border border-white/50">
                <button onclick="app.closeModal('themeModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-plus mr-2 text-red-500"></i>新增團戰/請假主題</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">主題名稱 (例如：週日城戰)</label>
                        <input type="text" id="themeNameInput" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-red-200 text-slate-700" placeholder="輸入主題名稱">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">圖標 (Font Awesome Class)</label>
                        <input type="text" id="themeIconInput" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-red-200 text-slate-700" value="fas fa-star" placeholder="例如: fas fa-star">
                        <p class="text-xs text-slate-400 mt-1">請輸入 Font Awesome Class 名稱。</p>
                    </div>
                </div>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-slate-100 shrink-0 gap-3">
                    <button type="button" onclick="app.closeModal('themeModal')" class="px-4 py-2 text-slate-500 hover:text-slate-800 font-bold">取消</button>
                    <button type="button" onclick="app.saveCustomTheme()" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg active:scale-95 transition border-b-4 border-red-800">儲存主題</button>
                </div>
            </div>
        </div>

        <div id="activityModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col max-h-[90vh] border border-white/50">
                <button onclick="app.closeModal('activityModal')" class="absolute top-4 right-4 text-slate-400 hover:text-slate-800 p-2"><i class="fas fa-times text-xl"></i></button>
                <h3 id="activityModalTitle" class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-trophy mr-2 text-yellow-500"></i>新增活動</h3>
                <div class="flex-grow overflow-y-auto space-y-4 custom-scrollbar">
                    <input type="hidden" id="activityIdInput">
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">活動名稱</label>
                        <input type="text" id="activityNameInput" class="w-full bg-slate-50 border-0 rounded-xl p-3 font-bold outline-none focus:ring-2 focus:ring-yellow-200 text-slate-700" placeholder="例如：聖誕造型大賽">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-500 mb-1 font-bold">說明/獎勵</label>
                        <textarea id="activityNoteInput" rows="2" class="w-full bg-slate-50 border-0 rounded-xl p-3 outline-none focus:ring-2 focus:ring-yellow-200" placeholder="活動說明、獎勵內容"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-500 mb-2 font-bold flex justify-between">
                            <span>獲獎成員 (<span id="activityWinnerCount">0</span> 人)</span>
                            <button onclick="app.openWinnerSelectionModal()" class="text-xs text-blue-500 hover:text-blue-700 font-bold"><i class="fas fa-user-plus mr-1"></i> 選擇成員</button>
                        </label>
                        <div id="activityWinnersList" class="space-y-2 max-h-[150px] overflow-y-auto p-2 border border-slate-200 rounded-xl"></div>
                    </div>
                </div>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-slate-100 shrink-0 gap-3">
                     <button type="button" onclick="app.deleteActivity()" id="deleteActivityBtn" class="px-4 py-2 text-red-500 hover:text-red-700 font-bold hidden">刪除</button>
                     <button type="button" onclick="app.closeModal('activityModal')" class="px-4 py-2 text-slate-500 hover:text-slate-800 font-bold">取消</button>
                     <button type="button" onclick="app.saveActivity()" class="px-6 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-bold rounded-xl shadow-lg active:scale-95 transition border-b-4 border-yellow-800">儲存活動</button>
                </div>
            </div>
        </div>

        <div id="winnerSelectionModal" class="modal-overlay fixed inset-0 bg-slate-900/50 backdrop-blur-sm hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-lg shadow-2xl p-6 relative flex flex-col max-h-[90vh] border border-white/50">
                <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b border-slate-100"><i class="fas fa-list-check mr-2 text-blue-500"></i>選擇獲獎成員</h3>
                <div class="flex-grow overflow-y-auto space-y-4 custom-scrollbar">
                    <div class="flex space-x-2 mb-3">
                        <select id="winnerRoleFilter" onchange="app.renderActivityWinnersList()" class="bg-slate-50 border border-slate-200 rounded-lg px-2 py-0.5 text-xs">
                            <option value="all">所有職位</option>
                            <option value="tank">坦克</option>
                            <option value="physical_dps">物理輸出</option>
                            <option value="magical_dps">魔法輸出</option>
                            <option value="support">輔助</option>
                            <option value="utility">功能</option>
                            <option value="other">其他</option>
                        </select>
                        <input type="text" id="winnerMemberSearch" oninput="app.renderActivityWinnersList()" placeholder="搜尋成員名稱..." class="bg-slate-50 border border-slate-200 rounded-lg px-2 py-0.5 text-xs flex-grow">
                    </div>
                    <div id="winnerSelectGrid" class="grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-[350px] overflow-y-auto p-1 border border-slate-200 rounded-xl"></div>
                </div>
                <div class="flex justify-end items-center mt-6 pt-4 border-t border-slate-100 shrink-0 gap-3">
                     <button type="button" onclick="app.closeModal('winnerSelectionModal')" class="px-4 py-2 text-slate-500 hover:text-slate-800 font-bold">取消</button>
                     <button type="button" onclick="app.applyWinnerSelection()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg active:scale-95 transition border-b-4 border-blue-800">確認選擇</button>
                </div>
            </div>
        </div>

    </main>
    <script src="./js/config.js"></script>
    <script src="./js/app.js"></script>
    <script>App.init();</script>
</body>
</html>